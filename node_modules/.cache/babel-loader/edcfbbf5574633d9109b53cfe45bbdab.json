{"ast":null,"code":"import _regeneratorRuntime from\"/Users/javier/Documents/BudgetFrontend/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/javier/Documents/BudgetFrontend/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/javier/Documents/BudgetFrontend/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{createContext,useState,useEffect}from\"react\";import jwt_decode from\"jwt-decode\";import{useNavigate}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";var AuthContext=/*#__PURE__*/createContext();export default AuthContext;export var AuthProvider=function AuthProvider(_ref){var children=_ref.children;var history=useNavigate();var _useState=useState(true),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState(function(){return localStorage.getItem(\"authTokens\")?JSON.parse(localStorage.getItem(\"authTokens\")):null;}),_useState4=_slicedToArray(_useState3,2),authTokens=_useState4[0],setAuthTokens=_useState4[1];var _useState5=useState(function(){return localStorage.getItem(\"authTokens\")?jwt_decode(localStorage.getItem(\"authTokens\")):null;}),_useState6=_slicedToArray(_useState5,2),user=_useState6[0],setUser=_useState6[1];var loginUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var response,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();_context.next=3;return fetch(\"token/\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({username:e.target.elements.formBasicName.value,password:e.target.elements.formBasicPassword.value})});case 3:response=_context.sent;_context.next=6;return response.json();case 6:data=_context.sent;if(response.status===200){setAuthTokens(data);setUser(jwt_decode(data.access));localStorage.setItem(\"authTokens\",JSON.stringify(data));history(\"/\");}else{alert(\"no user found\");}case 8:case\"end\":return _context.stop();}}},_callee);}));return function loginUser(_x){return _ref2.apply(this,arguments);};}();var logoutUser=function logoutUser(){setAuthTokens(null);setUser(null);localStorage.removeItem(\"authTokens\");history(\"/start\");};/*let updateToken = async () => {\n    let response = await fetch(\n      \"http://127.0.0.1:8000/token/refresh/\",\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          refresh: authTokens?.refresh,\n        }),\n      }\n    );\n    let data = await response.json();\n\n    if (response.status === 200) {\n      setAuthTokens(data);\n      setUser(jwt_decode(data.access));\n      localStorage.setItem(\"authTokens\", JSON.stringify(data));\n    } else {\n      logoutUser();\n    }\n    if (loading) {\n      setLoading(false);\n    }\n  };*/var contextData={user:user,authTokens:authTokens,loginUser:loginUser,logoutUser:logoutUser};useEffect(function(){var updateToken=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var response,data;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return fetch(\"token/refresh/\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({refresh:authTokens===null||authTokens===void 0?void 0:authTokens.refresh})});case 2:response=_context2.sent;_context2.next=5;return response.json();case 5:data=_context2.sent;if(response.status===200){setAuthTokens(data);setUser(jwt_decode(data.access));localStorage.setItem(\"authTokens\",JSON.stringify(data));}else{logoutUser();}if(loading){setLoading(false);}case 8:case\"end\":return _context2.stop();}}},_callee2);}));return function updateToken(){return _ref3.apply(this,arguments);};}();if(loading){updateToken();}var fourMinutes=100*60*4;var interval=setInterval(function(){if(authTokens){updateToken();}},fourMinutes);return function(){return clearInterval(interval);};},[authTokens,loading]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:contextData,children:loading?null:children});};","map":{"version":3,"names":["createContext","useState","useEffect","jwt_decode","useNavigate","AuthContext","AuthProvider","children","history","loading","setLoading","localStorage","getItem","JSON","parse","authTokens","setAuthTokens","user","setUser","loginUser","e","preventDefault","fetch","method","headers","body","stringify","username","target","elements","formBasicName","value","password","formBasicPassword","response","json","data","status","access","setItem","alert","logoutUser","removeItem","contextData","updateToken","refresh","fourMinutes","interval","setInterval","clearInterval"],"sources":["/Users/javier/Documents/BudgetFrontend/frontend/src/Context/AuthContext.js"],"sourcesContent":["import { createContext, useState, useEffect } from \"react\";\nimport jwt_decode from \"jwt-decode\";\nimport { useNavigate } from \"react-router-dom\";\n\nconst AuthContext = createContext();\n\nexport default AuthContext;\n\nexport const AuthProvider = ({ children }) => {\n  const history = useNavigate();\n\n  let [loading, setLoading] = useState(true);\n\n  let [authTokens, setAuthTokens] = useState(() =>\n    localStorage.getItem(\"authTokens\")\n      ? JSON.parse(localStorage.getItem(\"authTokens\"))\n      : null\n  );\n\n  let [user, setUser] = useState(() =>\n    localStorage.getItem(\"authTokens\")\n      ? jwt_decode(localStorage.getItem(\"authTokens\"))\n      : null\n  );\n\n  let loginUser = async (e) => {\n    e.preventDefault();\n    let response = await fetch(\"token/\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        username: e.target.elements.formBasicName.value,\n        password: e.target.elements.formBasicPassword.value,\n      }),\n    });\n    let data = await response.json();\n    if (response.status === 200) {\n      setAuthTokens(data);\n      setUser(jwt_decode(data.access));\n      localStorage.setItem(\"authTokens\", JSON.stringify(data));\n      history(\"/\");\n    } else {\n      alert(\"no user found\");\n    }\n  };\n\n  let logoutUser = () => {\n    setAuthTokens(null);\n    setUser(null);\n    localStorage.removeItem(\"authTokens\");\n    history(\"/start\");\n  };\n\n  /*let updateToken = async () => {\n    let response = await fetch(\n      \"http://127.0.0.1:8000/token/refresh/\",\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          refresh: authTokens?.refresh,\n        }),\n      }\n    );\n    let data = await response.json();\n\n    if (response.status === 200) {\n      setAuthTokens(data);\n      setUser(jwt_decode(data.access));\n      localStorage.setItem(\"authTokens\", JSON.stringify(data));\n    } else {\n      logoutUser();\n    }\n    if (loading) {\n      setLoading(false);\n    }\n  };*/\n\n  let contextData = {\n    user: user,\n    authTokens: authTokens,\n    loginUser: loginUser,\n    logoutUser: logoutUser,\n  };\n\n  useEffect(() => {\n    let updateToken = async () => {\n      let response = await fetch(\"token/refresh/\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          refresh: authTokens?.refresh,\n        }),\n      });\n      let data = await response.json();\n\n      if (response.status === 200) {\n        setAuthTokens(data);\n        setUser(jwt_decode(data.access));\n        localStorage.setItem(\"authTokens\", JSON.stringify(data));\n      } else {\n        logoutUser();\n      }\n      if (loading) {\n        setLoading(false);\n      }\n    };\n    if (loading) {\n      updateToken();\n    }\n    let fourMinutes = 100 * 60 * 4;\n    let interval = setInterval(() => {\n      if (authTokens) {\n        updateToken();\n      }\n    }, fourMinutes);\n    return () => clearInterval(interval);\n  }, [authTokens, loading]);\n\n  return (\n    <AuthContext.Provider value={contextData}>\n      {loading ? null : children}\n    </AuthContext.Provider>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}